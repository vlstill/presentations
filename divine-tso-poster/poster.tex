%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Jacobs Portrait Poster
% LaTeX Template
% Version 1.0 (31/08/2015)
% (Based on Version 1.0 (29/03/13) of the landscape template
%
% Created by:
% Computational Physics and Biophysics Group, Jacobs University
% https://teamwork.jacobs-university.de:8443/confluence/display/CoPandBiG/LaTeX+Poster
% 
% Further modified by:
% Nathaniel Johnston (nathaniel@njohnston.ca)
%
% Portrait version by:
% John Hammersley
%
% The landscape version of this template was downloaded from:
% http://www.LaTeXTemplates.com
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[final, 20pt, a0]{beamer}


\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

\usepackage[scale=1.15]{beamerposter} % Use the beamerposter package for laying out the poster

\usetheme{confposter} % Use the confposter theme supplied with this template

\usepackage{natbib}

\definecolor{mublue}{RGB}{27,69,143} % {cmyk}{0.81,0.52,0,0.44}
\setbeamercolor{structure}{fg=mublue}
\setbeamercolor{cboxb}{bg=mublue}
\setbeamercolor{title in headline}{fg=mublue}
\setbeamercolor{block title}{fg=mublue,bg=white} % Colors of the block titles
\setbeamercolor{block body}{fg=black,bg=white} % Colors of the body of blocks
\setbeamercolor{block alerted title}{fg=white,bg=mublue} % Colors of the highlighted block titles
\setbeamercolor{block alerted body}{fg=black,bg=mublue} % Colors of the body of highlighted blocks
% Many more colors are available for use in beamerthemeconfposter.sty

%-----------------------------------------------------------
% Define the column widths and overall poster size
% To set effective sepwid, onecolwid and twocolwid values, first choose how many columns you want and how much separation you want between columns
% In this template, the separation width chosen is 0.024 of the paper width and a 4-column layout
% onecolwid should therefore be (1-(# of columns+1)*sepwid)/# of columns e.g. (1-(4+1)*0.024)/4 = 0.22
% Set twocolwid to be (2*onecolwid)+sepwid = 0.464
% Set threecolwid to be (3*onecolwid)+2*sepwid = 0.708

\newlength{\sepwid}
\newlength{\marginwid}
\newlength{\onecolwid}
\newlength{\twocolwid}
\newlength{\threecolwid}
% \setlength{\paperwidth}{841mm} % A0 width: 46.8in
% \setlength{\paperheight}{1189mm} % A0 height: 33.1in
\setlength{\sepwid}{20mm} % Separation width (white space) between columns
\setlength{\marginwid}{80mm} % Margin width (white space) left and right
\setlength{\onecolwid}{214mm} % Width of one column
\setlength{\twocolwid}{\onecolwid} % Width of two columns
\addtolength{\twocolwid}{\onecolwid}
\addtolength{\twocolwid}{\sepwid}
\setlength{\threecolwid}{0.708\paperwidth} % Width of three columns
\setlength{\topmargin}{1cm}

\usepackage{xspace}
\usepackage{pdfpages}
\usepackage{microtype}
\usepackage{booktabs}
\usepackage[export]{adjustbox}

\newcommand{\TODO}[1]{\textcolor{red}{#1}}
\setlength{\overfullrule}{5pt} % TODO: remove

%-----------------------------------------------------------
\usepackage{wrapfig}
\usepackage{tikz}
\usetikzlibrary{shapes,arrows,arrows.meta,decorations.markings}

\usepackage{graphicx}  % Required for including images
\usepackage{booktabs} % Top and bottom rules for tables
\usepackage[english]{babel}

\usepackage{lipsum}

\newcommand{\xtso}{\mbox{x86-\kern-.15em TSO}\xspace}
\newcommand{\divine}{\mbox{DIVINE}\xspace}
\colorlet{flushed}{yellow!60!red!85!black}

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\newcommand{\titletext}{Model Checking of C++ Programs under the \xtso Memory Model}
\newcommand{\logowidth}{2.6\baselineskip}
\title{%
  \texorpdfstring{%
    \makebox[\linewidth]{%
      \noindent\hspace*{0.5em} %
      \begin{minipage}{\logowidth}%
          \includegraphics[width=\logowidth]{mu_logo.pdf} %
      \end{minipage}%
      \hfill %
      \begin{minipage}{\linewidth - \logowidth - \logowidth - 3em}\center\titletext\end{minipage} %
      \hfill %
      \begin{minipage}{\logowidth}%
         \includegraphics[width=\logowidth]{fi_logo.pdf} %
      \end{minipage}
      \hspace*{0.5em}%
    }%
  }
  {\titletext}} % Poster title

\author{Vladimír Štill and Jiří Barnat} % Author(s)

\institute{Faculty of Informatics, Masaryk University\vspace*{-2cm}} % Institution(s)

%----------------------------------------------------------------------------------------

\begin{document}

\addtobeamertemplate{block end}{}{\vspace*{2ex}} % White space under blocks
\addtobeamertemplate{block alerted end}{}{\vspace*{2ex}} % White space under highlighted (alert) blocks

\setlength{\belowcaptionskip}{2ex} % White space under figures
\setlength\belowdisplayshortskip{2ex} % White space under equations

\begin{frame}[t] % The whole poster is enclosed in one beamer frame

\begin{columns}[t] % The whole poster consists of three major columns, the second of which is split into two columns twice - the [t] option aligns each column's content to the top

\begin{column}{\marginwid}\end{column} % Empty spacer column
\begin{column}{\onecolwid} % The first column

\begin{block}{Relaxed Memory}

Almost all recent processors exhibit relaxed memory behavior, which, together with the rise of multicore processors and parallel programs means that programmers have to deal with its complexities.
Even on x86 processors, which have stronger memory model than most other architectures, programmers often have to decide whether to play safe with higher level synchronization constructs such as mutexes, or tap to the full power of the architecture and risk subtle unintuitive behavior of relaxed memory accesses.

Here, we present an extension of the \divine model checker which allows for analysis of C and C++ programs under the \xtso relaxed memory model.
This means that \divine can now validate parallel programs intended to run on x86 processors more precisely.
The novelty of our approach is in a careful design of an encoding of \xtso operations so that nondeterminism is minimized, and therefore the performance of analysis is increased.
In particular, we allow for nondeterminism only in connection with memory fences and load operations of those memory addresses that were written to by a preceding store.

\end{block}

\end{column} % End of the first column

\begin{column}{\sepwid}\end{column} % Empty spacer column

\begin{column}{\twocolwid} % Begin a column which is two columns wide (column 2)

\begin{block}{The \xtso Memory Model}

    \begin{figure}[h]
    \begingroup
    \centering
    \begingroup
    \tt
    \begin{columns}
    \begin{column}{12cm}
    \textcolor{gray}{int} x = 0, y = 0; \\
    \textcolor{gray}{void} thread0() \{ \\
    \ \ \ \ y = 1; \\
    \ \ \ \ \textcolor{gray}{int} a = x; \\
    \ \ \ \ \textcolor{gray}{int} c = y; \\
    \}
    \end{column}
    \begin{column}{12cm}
    \mbox{}\\
    \textcolor{gray}{void} thread1() \{ \\
    \ \ \ \ x = 1; \\
    \ \ \ \ \textcolor{gray}{int} b = y; \\
    \ \ \ \ \textcolor{gray}{int} d = x; \\
    \}
    \end{column}
    \end{columns}\mbox{}
    \endgroup

    \noindent\medskip
    is $a = 0 \land b = 0$ reachable?\\[2.05ex]
    \endgroup

    \begin{center}
    \begin{tikzpicture}[ ->, >=stealth', shorten >=1pt, auto, node distance=3cm
                       , semithick
                       , scale=2
                       , thck/.style = { thick, decoration={markings,mark=at position 1 with {\arrow[scale=4]{>}}}, postaction={decorate}, },
                       ]

      \draw [-] (-10,0) rectangle (-7,-5);
      \draw [-] (-10,-1) -- (-7,-1)
                (-10,-2) -- (-7,-2)
                (-10,-3) -- (-7,-3)
                (-10,-4) -- (-7,-4);
      \draw [-] (-9,0) -- (-9,-5);
      \node () [anchor=west] at (-10,0.5) {memory};
      \node () [anchor=west] at (-10,-2.5)  {\texttt{\color{blue}x}};
      \node () [anchor=west] at (-9,-2.5) {\texttt{\color{blue}0}};

      \node () [anchor=west] at (-10,-3.5)  {\texttt{\color{blue}y}};
      \node () [anchor=west] at (-9,-3.5)  {\texttt{\color{blue}0}};

      \node () [anchor=center] at (-2,-3.5) {store buffer};
      \node () [anchor=center] at (4,-3.5) {store buffer};

      \draw [-] (-4,-4) rectangle (0,-5);
      \draw [-] (2,-4) rectangle (6,-5);
      \draw [-] (-2,-4) -- (-2,-5);
      \draw [-] (4,-4) -- (4,-5);

      \node () [anchor=west] at (-4,-4.5)  {\texttt{\color{red}y}};
      \node () [anchor=west] at (-2,-4.5)  {\texttt{\color{red}1}};

      \node () [anchor=west] at (2,-4.5)  {\texttt{\color{red}x}};
      \node () [anchor=west] at (4,-4.5)  {\texttt{\color{red}1}};

      \node () [] at (-4, 0.5) {thread 0};
      \draw [->, thck] (-4,0) -- (-4,-3);
      \node () [anchor=west] at (-3.5, -0.5) {\texttt{\color{red}y = 1;}};
      \node () [anchor=west] at (-3.5, -1.5) {\texttt{\color{blue}load x; \textrightarrow 0}};
      \node () [anchor=west] at (-3.5, -2.5) {\texttt{\color{dgreen}load y; \textrightarrow 1}};

      \node () [] at (2, 0.5) {thread 1};
      \draw [->, thck] (2,0) -- (2,-3);
      \node () [anchor=west] at (2.5, -0.5) {\texttt{\color{red}x = 1;}};
      \node () [anchor=west] at (2.5, -1.5) {\texttt{\color{blue}load y; \textrightarrow 0}};
      \node () [anchor=west] at (2.5, -2.5) {\texttt{\color{dgreen}load x; \textrightarrow 1}};

  \end{tikzpicture}
  \end{center}

  \caption{
  A demonstration of the \xtso memory model.
  The thread 0 stores 1 to variable \texttt{y} and then loads variables \texttt{x} and \texttt{y}.
  The thread 1 stores 1 to \texttt{x} and then loads \texttt{y} and \texttt{x}.
  Intuitively, we would expect it to be impossible for $a = 0$ and $b = 0$ to both be true at the end of the execution, as there is no interleaving of thread actions which would produce such a result.
  However, under \xtso, the stores are cached in thread-local store buffers (marked \textcolor{red}{red}).
  A load consults only shared memory and the store buffer of the given thread, which means it can load data from the memory and ignore newer values from the other thread (\textcolor{blue}{blue}).
  Therefore \texttt{a} and \texttt{b} will contain old values from the memory.
  On the other hand, \texttt{c} and \texttt{d} will contain local values from the store buffers (locally read values are marked \textcolor{dgreen}{green}).
  }
  \vspace{-1ex}
  \end{figure}

\end{block}

\end{column} % End of the double

\begin{column}{\marginwid}\end{column} % Empty spacer column

\end{columns}

\begin{columns}[t] % The whole poster consists of three major columns, the second of which is split into two columns twice - the [t] option aligns each column's content to the top

\begin{column}{\marginwid}\end{column} % Empty spacer column
\begin{column}{\onecolwid} % The first column

\begin{block}{Results}

We compare our approach with state-of-the-art bounded model checker CBMC and stateless model checker Nidhugg and show that extended \divine competes well with both of them.
The evaluation is performed on SV-COMP concurrency benchmarks without data nondeterminism.
Of these benchmarks, \divine can solve more instances and discover more bugs than both of the other tools.
The following table shows how many benchmarks were completed by each of the tools, how many of these contained errors under \xtso, but not without relaxed memory, and how many benchmarks were only solved by the given tool and not the other two tools.

\begingroup
\vspace{3ex}
\centering
\setlength\tabcolsep{0.5em} %
\renewcommand{\arraystretch}{1.1} %
\begin{tabular}{lrrr} \toprule
             & CBMC & Nidhugg & DIVINE \\ \midrule
    finished &   21 &      25 &     27 \\
    TSO bugs &    3 &       3 &      9 \\
    unique   &    5 &       3 &      5 \\
    \bottomrule
\end{tabular}
\endgroup
\bigskip
\end{block}

\bigskip
\includegraphics[width=0.3\onecolwid, valign=t]{qrcode}
\rm\footnotesize\href{https://divine.fi.muni.cz/2018/x86tso/}{https://divine.fi.muni.cz/2018/x86tso/}

\end{column} % End of the first column

\begin{column}{\sepwid}\end{column} % Empty spacer column

\begin{column}{\twocolwid} % Begin a column which is two columns wide (column 2)

\begin{block}{Delayed Flushing}

\xtso is a Total Store Order memory model, which means store buffers maintain execution order of stores.
The main novelty of our approach is \emph{delayed flushing} which allows us to remove entries from the store buffer in order in which the corresponding values are read instead of the store order.
This improvement limits nodeterminism by delaying it as long as possible.
The reduced nondeterminism translates to better performance of verification using an explicit-state model checker.

\begin{figure}[h]
\vspace{0.58ex}
\newcommand{\colwidth}{0.31\twocolwid}

\begin{minipage}[t]{\colwidth}
\begin{tikzpicture}[ ->, >=stealth', shorten >=1pt, auto, node distance=3cm
                   , semithick
                   , scale=1.9
                   , thck/.style = { thick, decoration={markings,mark=at position 1 with {\arrow[scale=4]{>}}}, postaction={decorate}, },
                   ]

  \draw [-] (-10,0) rectangle (-7,-4);
  \draw [-] (-10,-1) -- (-7,-1)
            (-10,-2) -- (-7,-2)
            (-10,-3) -- (-7,-3);
  \node () [anchor=center] at (-8.5, 0.5) {s.b. 1};
  \node () [anchor=center] at (-8.5,-0.5) {\texttt{x $\leftarrow$ 1}};
  \node () [anchor=center] at (-8.5,-1.5) {\texttt{y $\leftarrow$ 1}};
  \node () [anchor=center] at (-8.5,-2.5) {\texttt{x $\leftarrow$ 2}};
  \node () [anchor=center] at (-8.5,-3.5) {\color{dgreen}\texttt{y $\leftarrow$ 2}};

  \draw [-] (-6,0) rectangle (-3,-4);
  \draw [-] (-6,-1) -- (-3,-1)
            (-6,-2) -- (-3,-2)
            (-6,-3) -- (-3,-3);
  \node () [anchor=center] at (-4.5, 0.5) {s.b. 2};
  \node () [anchor=center] at (-4.5,-0.5) {\texttt{x $\leftarrow$ 3}};
  \node () [anchor=center] at (-4.5,-1.5) {\texttt{y $\leftarrow$ 3}};

\end{tikzpicture}
\begingroup
    \tt
    \textcolor{gray}{void} thread0() \{ \\
    \indent{}\textcolor{gray}{int} a = y; \\
    \indent{}\textcolor{gray}{int} b = x; \\
    \}
\endgroup

\caption{
Suppose \texttt{thread0} is about to execute with the displayed contents of store buffers of two other threads and suppose it had nondeterministically chosen to load value 2 from \texttt{y} (denoted by \textcolor{dgreen}{green} in the figure).
The entries at the top of the store buffers are the oldest entries.
}

\label{fig:flushflagA}

\end{minipage}
%
\hfill
%
\begin{minipage}[t]{\colwidth}

\begin{tikzpicture}[ ->, >=stealth', shorten >=1pt, auto, node distance=3cm
                   , semithick
                   , scale=1.9
                   , thck/.style = { thick, decoration={markings,mark=at position 1 with {\arrow[scale=4]{>}}}, postaction={decorate}, },
                   ]

  \draw [-] (-10,0) rectangle (-7,-4);
  \draw [-] (-10,-1) -- (-7,-1)
            (-10,-2) -- (-7,-2)
            (-10,-3) -- (-7,-3);
  \node () [anchor=center] at (-8.5, 0.5) {s.b. 1};
  \node () [anchor=center] at (-8.5,-0.5) {\color{flushed}\texttt{x $\leftarrow$ 1}};
  \node () [anchor=center] at (-8.5,-1.5) {\color{flushed}\texttt{x $\leftarrow$ 2}};

  \draw [-] (-6,0) rectangle (-3,-4);
  \draw [-] (-6,-1) -- (-3,-1)
            (-6,-2) -- (-3,-2)
            (-6,-3) -- (-3,-3);
  \node () [anchor=center] at (-4.5, 0.5) {s.b. 2};
  \node () [anchor=center] at (-4.5,-0.5) {\color{dgreen}\texttt{x $\leftarrow$ 3}};
  \node () [anchor=center] at (-4.5,-1.5) {\texttt{y $\leftarrow$ 3}};

\end{tikzpicture}

\begingroup
    \tt
    \textcolor{gray}{void} thread0() \{ \\
    \indent{}\textcolor{gray}{int} a = y; \textcolor{gray}{// \textrightarrow 2} \\
    \indent{}\textcolor{gray}{int} b = x; \\
    \}
\endgroup

\caption{At this point, \texttt{x}~entries of store buffer 1 are marked as flushed (\textcolor{flushed}{orange}) and the \mbox{$\texttt{y} \leftarrow \texttt{1}$} entry was removed as it was succeeded by the used entry \mbox{$\texttt{y} \leftarrow \texttt{2}$}.
The thread had nondeterministically selected to load \texttt{x} from store buffer 2.}

\label{fig:flushflagB}

\end{minipage}
%
\hfill
%
\begin{minipage}[t]{\colwidth}

\begin{tikzpicture}[ ->, >=stealth', shorten >=1pt, auto, node distance=3cm
                   , semithick
                   , scale=1.9
                   , thck/.style = { thick, decoration={markings,mark=at position 1 with {\arrow[scale=4]{>}}}, postaction={decorate}, },
                   ]

  \draw [-] (-10,0) rectangle (-7,-4);
  \draw [-] (-10,-1) -- (-7,-1)
            (-10,-2) -- (-7,-2)
            (-10,-3) -- (-7,-3);
  \node () [anchor=center] at (-8.5, 0.5) {s.b. 1};

  \draw [-] (-6,0) rectangle (-3,-4);
  \draw [-] (-6,-1) -- (-3,-1)
            (-6,-2) -- (-3,-2)
            (-6,-3) -- (-3,-3);
  \node () [anchor=center] at (-4.5, 0.5) {s.b. 2};
  \node () [anchor=center] at (-4.5,-0.5) {\texttt{y $\leftarrow$ 3}};

\end{tikzpicture}

\begingroup
    \tt
    \textcolor{gray}{void} thread0() \{ \\
    \indent{}\textcolor{gray}{int} a = y; \textcolor{gray}{// \textrightarrow 2} \\
    \indent{}\textcolor{gray}{int} b = x; \textcolor{gray}{// \textrightarrow 3} \\
    \}
\endgroup

\caption{
In the load of \texttt{x}, all \texttt{x} entries were evicted from the buffers -- all the flushed entries for \texttt{x} (which were not selected) had to be dropped before \mbox{$\texttt{x} \leftarrow \texttt{3}$} was propagated to the memory.
The last entry (\mbox{$\texttt{y} \leftarrow \texttt{3}$}) will remain in the store buffer if \texttt{y} will never be loaded in the program again.
}

\label{fig:flushflagC}

\end{minipage}
\end{figure}

\end{block}

\end{column} % End of the double

\begin{column}{\marginwid}\end{column} % Empty spacer column

\end{columns}

% \vspace{-5ex}
% \hspace{0.5in}\begin{beamercolorbox}[wd=816mm,colsep=0.15cm]{cboxb}\end{beamercolorbox}
%
% \begin{columns}
% \begin{column}{\marginwid}\end{column} % Empty spacer column
% \begin{column}{\onecolwid}
% \\[1ex]
% \end{column}
% \begin{column}{\sepwid}\end{column} % Empty spacer column
% \begin{column}{\twocolwid}\end{column} % Empty spacer column
% \begin{column}{\marginwid}\end{column} % Empty spacer column
% \end{columns}

\end{frame} % End of the enclosing frame

\end{document}

% vim: spell spelllang=en tw=80 fo+=t
